# Redis

[TOC]

### 底层结构

#### SDS（Simple Dynamic String）

>redis底层用C语言实现，它没有用C语言的字符类型，自己实现了一套SDS结构

```c
struct sdshdr {
    // 当前字符串长度
	int len;
    // 剩余可用长度
	int free;
    // 实际存储字符串
	char buf[];
}
```

> reids的key是一个SDS值，value如果是String类型，实际存储的也是SDS，非String是long类型

#### 与C字符串的区别

##### 1、计数方式

>C字符串从前向后遍历，知道空字符（\0）为止
>
>sds自己维护了len长度

##### 2、长度变更

>C字符串做修改比如拼接，如果没计算好内存，会产生溢出
>
>sds通过free判断剩余空间是否足够，如果不够会进行扩容

##### 3、减少修改时内存重新分配次数

> 每次修改后，预留free空间，避免频繁扩展；（如果多次未用到会回收）

##### 4、二进制安全

> C通过空字符（\0）判断长度，很多数据类型会穿插空字符比如说图片视频音频等，sds使用len避免了这种误判